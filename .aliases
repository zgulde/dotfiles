# +-------------------------------------------------------+
# |              general utility                          |
# +-------------------------------------------------------+

alias .='cd ..'
alias ..='cd ../..'
alias ...='cd ../../..'
alias ....='cd ../../../..'
alias .....='cd ../../../../..'

alias subl.='subl .'

alias warpspeed="ssh warpspeed@$MY_SERVER"

alias ehf='sudo vim /etc/hosts'

# I edit this stuff way too much
alias reload='source ~/.bash_profile; source ~/.aliases'

alias cls='clear'

alias pbgrep='pbpaste | grep'
alias pback='pbpaste | ack'
alias pbvim='pbpaste | vim -'

# open a finder here
alias f='open -a Finder ./' 

alias curlput='curl -X PUT'
alias curlget='curl -X GET'
alias curlpost='curl -X POST'

# goes to ~/vagrant-lamp/sites if no arguments are passed, otherwise
# goes to $1.dev
function vl {
	if [ -z "$1" ]
	then
		cd ~/vagrant-lamp/sites/
		lt
	else
		cd ~/vagrant-lamp/sites/$1.dev
		git status
	fi
}

# get the HTTP status code from a site eg getStatus google.com
function getStatus {
	curl -vs $1 2>&1 | grep '< HTTP/1.1'  | sed -e 's/< HTTP\/1\.1\ //g'
}

function mkdircd {
    mkdir $1; cd $1;
}

# use curl to just get the reponse headers instead of a full response
function curlh {
    curl -s -D - $1 -o /dev/null | sed 's/.*/< &/'
}

# cowsay with a random cow
function randcowsay {
    NUMOFCOWS=`cowsay -l | tail -n +2 | wc -w`
    WHICHCOW=$((RANDOM%$NUMOFCOWS+1))
    THISCOW=`cowsay -l | tail -n +2 | sed -e 's/\ /\'$'\n/g' | sed $WHICHCOW'q;d'`

    cowsay -f $THISCOW $1
}

# echos enough '=' to fill one line 
function echolinebreak {
	numcolumns=$(tput cols)
	linebreak=""
	for (( c=0; c<numcolumns; c++ ))
	do
	   linebreak="=$linebreak"
	done
		echo $linebreak
}

# sends an email from my mailgun domain
#   $ sendEmail <to> <subject> <body> [from='Don't Reply']
function sendEmail {

	if [ "$1" == "help" ]
	then
		echo ""
		echo "description"
		echo "    sends an email from my mailgun domain"
		echo "usage"
		echo "    $ sendEmail <to> <subject> <body> [from='Don't Reply']"
		echo ""
		return 
    fi

    TO=$1
    SUBJECT=$2
    BODY=$3
    FROM=$4

    if [ -z FROM ]
	then
		FROM="Don't Reply"
	fi

    curl -s --user "api:$MAILGUN_API_KEY" \
        https://api.mailgun.net/v3/$MAILGUN_DOMAIN/messages \
        -F from="$FROM <postmaster@$MAILGUN_DOMAIN>" \
        -F to="$TO" \
        -F subject="$SUBJECT" \
        -F text="$BODY"
}

# converts a string to escaped ascii codes
function toAsciiCodes {
    echo $1 | hexdump | sed -e 's/.\{7\}//' -e 's/ /\\x/g' | tr -d '\n' | sed -e 's/\(\\x\)*$//g' -e 's/\\x0a$//' | tr -d '\n'
}

function emoji {
    grep -i $1 ~/.emojis | sed 's/\(.*\)=\(.*\)#\(.*\)/\3 \1 \2/'
}

# +-------------------------------------------------------+
# |              preferable implementation                |
# +-------------------------------------------------------+

# confirmation and verbosity when manipulating files
alias rm='rm -iv'
alias mv='mv -iv'
alias cp='cp -iv'

alias egrep='egrep --color=auto'
alias grep='grep --color=auto'

# +-------------------------------------------------------+
# |                   ls stuff                            |
# +-------------------------------------------------------+

alias l='ls -Gp1h'
alias ls='ls -G'
alias lf='ls -dG1 */'
alias laf='ls -aG1 -d .*/ */'
alias ll='ls -Gplh'
alias la='ls -Gplah'
alias lt='echo "------- Most Recent --------" && ll -t'
alias lat='echo "------- Most Recent --------" && la -t'
alias ltr='ll -tr && echo "------- Most Recent --------"'
alias latr='la -tr && echo "------- Most Recent --------"'
alias lsd='la | lolcat'

# +---------------------------------------------------------+
# |                     git stuff                           |
# +---------------------------------------------------------+

alias gs='git status'
alias gl="git log --graph --pretty='<%Cred%H%Creset> %Cgreen%an%Creset %Cblue(%cr)%Creset%n%s%n%n%b'"
alias gd='git diff'
alias gdp='git diff HEAD^ HEAD' # show the difference with the previous commit
alias ga='git add'
alias gap='git add --patch'
alias gc='git commit'
alias gcm='git commit -m'
alias gb='git branch'
alias gco='git checkout'
alias gcob='git checkout -b'
alias push='git push origin'
alias pull="git pull origin master"
alias pushme='git push origin zach'
alias deploy='git push warpspeed master'

# do a git diff but just show which files are different
function gdf {
    gd $1 | grep ^diff | sed s/diff\ --git\ a/-\>\ \ /g
}

# parse_git_branch and parse_git_dirty copied from http://ezprompt.net/
# get current branch in git repo
function parse_git_branch() {
	BRANCH=`git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/'`
	if [ ! "${BRANCH}" == "" ]
	then
		STAT=`parse_git_dirty`
		echo "|${BRANCH}|${STAT}"
	else
		echo ""
	fi
}

# get current status of git repo
function parse_git_dirty {
	status=`git status 2>&1 | tee`
	dirty=`echo -n "${status}" 2> /dev/null | grep "modified:" &> /dev/null; echo "$?"`
	untracked=`echo -n "${status}" 2> /dev/null | grep "Untracked files" &> /dev/null; echo "$?"`
	ahead=`echo -n "${status}" 2> /dev/null | grep "Your branch is ahead of" &> /dev/null; echo "$?"`
	newfile=`echo -n "${status}" 2> /dev/null | grep "new file:" &> /dev/null; echo "$?"`
	renamed=`echo -n "${status}" 2> /dev/null | grep "renamed:" &> /dev/null; echo "$?"`
	deleted=`echo -n "${status}" 2> /dev/null | grep "deleted:" &> /dev/null; echo "$?"`
	bits=''
	if [ "${renamed}" == "0" ]; then
		bits=">${bits}"
	fi
	if [ "${ahead}" == "0" ]; then
		bits="*${bits}"
	fi
	if [ "${newfile}" == "0" ]; then
		bits="+${bits}"
	fi
	if [ "${untracked}" == "0" ]; then
		bits="?${bits}"
	fi
	if [ "${deleted}" == "0" ]; then
		bits="x${bits}"
	fi
	if [ "${dirty}" == "0" ]; then
		bits="!${bits}"
	fi
	if [ ! "${bits}" == "" ]; then
		echo " ${bits}"
	else
		echo ""
	fi
}

# just show first letter of the branch name and the symbols for modification
function minimal_git_status() {
    BRANCH=`git branch 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/\1/' | head -c 1`
	if [ ! "${BRANCH}" == "" ]
	then
		STAT=`parse_git_dirty`
		echo "${BRANCH}${STAT}"
	else
		echo ""
	fi
}

# +---------------------------------------------------------+
# |                 vagrant commands                        |
# +---------------------------------------------------------+

alias vs='vagrant status'
alias vh='vagrant halt'
alias vu='vagrant up'
alias vssh='cd ~/vagrant-lamp && vagrant ssh'
alias vreset='vagrant halt && vagrant up'
